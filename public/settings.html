<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - WeightTracker Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Using Tiempos Text font */

        :root {
            --neon-cyan: #0ff0fc;
            --neon-magenta: #ff00ff;
            --neon-lime: #00ff00;
            --neon-blue: #0066ff;
            --dark-bg: #0a0a1a;
            --card-bg: rgba(16, 16, 32, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            background: var(--dark-bg);
            min-height: 100vh;
            font-family: 'Tiempos Text', serif;
            color: #fff;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(0, 243, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(255, 0, 255, 0.1) 0%, transparent 50%);
            animation: holographicFloat 20s ease infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes holographicFloat {
            0%, 100% { transform: rotate(0deg) scale(1); }
            33% { transform: rotate(3deg) scale(1.05); }
            66% { transform: rotate(-2deg) scale(1.02); }
        }

        .main-content { padding: 30px; }

        .profile-header {
            background: linear-gradient(135deg, rgba(0, 102, 255, 0.2) 0%, rgba(255, 0, 255, 0.2) 50%, rgba(0, 255, 0, 0.2) 100%);
            border-radius: 25px;
            padding: 50px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            transform: perspective(1000px) rotateX(2deg);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), inset 0 0 0 1px rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
        }

        .profile-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: conic-gradient(from 0deg at 50% 50%, rgba(0, 255, 255, 0.1) 0%, rgba(255, 0, 255, 0.1) 25%, rgba(0, 255, 0, 0.1) 50%, rgba(0, 102, 255, 0.1) 75%, rgba(0, 255, 255, 0.1) 100%);
            animation: aurora 20s linear infinite;
            z-index: 0;
            border-radius: 25px;
        }

        @keyframes aurora {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .profile-header:hover {
            transform: perspective(1000px) rotateX(0deg) translateY(-5px);
        }

        .profile-content {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .avatar-upload-container {
            position: relative;
        }

        .profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 25px;
            background: linear-gradient(135deg, rgba(0, 102, 255, 0.3), rgba(255, 0, 255, 0.3));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: 700;
            color: var(--neon-cyan);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4), 0 0 15px rgba(0, 255, 255, 0.4);
            transform: perspective(500px) rotateY(-10deg);
            transition: all 0.3s;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            object-fit: cover;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 25px;
        }

        .profile-avatar:hover { transform: perspective(500px) rotateY(0deg) scale(1.05); }

        .avatar-upload-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue));
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid var(--dark-bg);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 2;
        }

        .avatar-upload-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.5);
        }

        #avatarInput { display: none; }

        .form-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3), inset 0 0 0 1px var(--glass-border);
            transform: perspective(1000px) rotateX(1deg);
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        .form-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta), var(--neon-lime));
            z-index: 1;
        }

        .form-card:hover {
            transform: perspective(1000px) rotateX(0deg) translateY(-5px);
        }

        .form-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--neon-cyan);
        }

        .form-control, .form-select {
            background: rgba(10, 10, 20, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px 15px;
            transition: all 0.3s;
            color: white;
        }

        .form-control:focus, .form-select:focus {
            background: rgba(10, 10, 20, 0.7);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 0 3px rgba(0, 255, 255, 0.1);
            color: white;
        }

        .form-label {
            color: var(--neon-lime);
            font-weight: 500;
            margin-bottom: 8px;
        }

        .btn-save {
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue));
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 102, 255, 0.4);
        }

        .btn-save:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 102, 255, 0.6);
            color: white;
        }

        .alert-holographic {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid;
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-holographic.show { display: flex; align-items: center; gap: 10px; animation: slideDown 0.5s; }

        .alert-holographic.success {
            border-color: var(--neon-lime);
            color: var(--neon-lime);
        }

        .alert-holographic.error {
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .profile-content { text-align: center; }
            .profile-header { padding: 30px 20px; }
            .form-card { padding: 20px; }
        }
    </style>
</head>
<body>
    <script src="/js/sidebar.js"></script>
    <div class="main-content">
        <div class="profile-header">
            <div class="profile-content">
                <div class="avatar-upload-container">
                    <div class="profile-avatar" id="avatarPreview">AG</div>
                    <div class="avatar-upload-btn" onclick="document.getElementById('avatarInput').click()">
                        <i class="fas fa-camera"></i>
                    </div>
                    <input type="file" id="avatarInput" accept="image/*">
                </div>
                <h2 class="text-center" style="color: var(--neon-cyan)">Edit Your Profile</h2>
                <p class="text-muted text-center">Update your personal information and settings</p>
            </div>
        </div>

        <div class="alert-holographic" id="alertMessage"></div>

        <div class="form-card">
            <h3 class="form-title">
                <i class="fas fa-user me-2"></i>
                Personal Information
            </h3>
            <form id="personalInfoForm">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" id="fullName" placeholder="Enter your full name">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" placeholder="your@email.com">
                    </div>
                                        
                    <div class="col-12">
                        <button type="submit" class="btn btn-save">
                            <i class="fas fa-save me-2"></i>
                            Save Personal Info
                        </button>
                    </div>
                </div>
            </form>
        </div>

       
                    
                </div>
            </form>
        </div>
    </div>

    <script>
        const token = localStorage.getItem('accessToken');

        // Load existing profile data
        async function loadProfileData() {
            try {
                const response = await fetch('/api/profile/profile', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) throw new Error('Failed to load profile');

                const profile = await response.json();

                // Update avatar
                const avatarEl = document.getElementById('avatarPreview');
                if (profile.avatar_url) {
                    avatarEl.innerHTML = `<img src="${profile.avatar_url}" alt="Avatar">`;
                } else {
                    const initials = (profile.full_name || profile.username)
                        .split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                    avatarEl.textContent = initials;
                }

                // Fill form fields
                document.getElementById('fullName').value = profile.full_name || '';
                document.getElementById('email').value = profile.email || '';
                document.getElementById('phone').value = profile.phone || '';
                document.getElementById('dateOfBirth').value = profile.date_of_birth || '';
                document.getElementById('gender').value = profile.gender || '';
                document.getElementById('height').value = profile.height || '';
                document.getElementById('currentWeight').value = profile.current_weight || '';
                document.getElementById('targetWeight').value = profile.target_weight || '';

            } catch (error) {
                console.error('Error loading profile:', error);
                showAlert('Failed to load profile data', 'error');
            }
        }

        // Handle avatar upload
        document.getElementById('avatarInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) {
                showAlert('File size must be less than 5MB', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('avatar', file);

            try {
                const response = await fetch('/api/profile/avatar', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` },
                    body: formData
                });

                if (!response.ok) throw new Error('Failed to upload avatar');

                const result = await response.json();
                document.getElementById('avatarPreview').innerHTML = 
                    `<img src="${result.avatarUrl}" alt="Avatar">`;
                showAlert('Avatar uploaded successfully!', 'success');

            } catch (error) {
                console.error('Error uploading avatar:', error);
                showAlert('Failed to upload avatar', 'error');
            }
        });

        // Handle personal info form
        document.getElementById('personalInfoForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const data = {
                full_name: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                date_of_birth: document.getElementById('dateOfBirth').value || null,
                gender: document.getElementById('gender').value || null
            };

            try {
                const response = await fetch('/api/profile/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message);
                }

                showAlert('Personal information updated successfully!', 'success');
            } catch (error) {
                console.error('Error:', error);
                showAlert(error.message || 'Failed to update personal information', 'error');
            }
        });

        // Handle measurements form
        document.getElementById('measurementsForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const data = {
                height: parseFloat(document.getElementById('height').value) || null,
                current_weight: parseFloat(document.getElementById('currentWeight').value) || null,
                target_weight: parseFloat(document.getElementById('targetWeight').value) || null
            };

            try {
                const response = await fetch('/api/profile/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) throw new Error('Failed to update measurements');

                showAlert('Body measurements updated successfully!', 'success');
            } catch (error) {
                console.error('Error:', error);
                showAlert('Failed to update body measurements', 'error');
            }
        });

        function showAlert(message, type) {
            const alert = document.getElementById('alertMessage');
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            alert.className = `alert-holographic show ${type}`;
            
            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        // Load data on page load
        document.addEventListener('DOMContentLoaded', loadProfileData);
    </script>
</body>
</html>